% vim: set filetype=erlang shiftwidth=4 tabstop=4 expandtab tw=80:
%%% =====================================================================
%%% This library is free software; you can redistribute it and/or modify
%%% it under the terms of the GNU Lesser General Public License as
%%% published by the Free Software Foundation; either version 2 of the
%%% License, or (at your option) any later version.
%%%
%%% This library is distributed in the hope that it will be useful, but
%%% WITHOUT ANY WARRANTY; without even the implied warranty of
%%% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
%%% Lesser General Public License for more details.
%%%
%%% You should have received a copy of the GNU Lesser General Public
%%% License along with this library; if not, write to the Free Software
%%% Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
%%% USA
%%%
%%% $Id$
%%%
%%% @copyright 2010-2011 Michael Uvarov
%%% @author Michael Uvarov <freeakk@gmail.com>
%%% =====================================================================

%%% @doc Functions for extraction UNIDATA.
%%%      UNIDATA is a part of The Unicode Character Database (UCD).
%%%      For character properties, casing behavior, default line-, word-,
%%%      cluster-breaking behavior, etc.
%%%      http://unicode.org/ucd/
%%%
%%%      This file calls ux_unidata_filelist.
%%%      ux_unidata_filelist contains the list of available files.
%%%      ux_unidata_filelist returns the anonymous function.
%%%      Fun extracts information from ETS table.
%%%      The ETS tables were generated by ux_unidata_store. 
%%%      ux_unidata_store is the owner of the list of ETS tables.
%%%      ux_unidata_store runs ux_unidata_parser, which runs one of
%%%      ux_unidata_parser_*.
%%%      ux_unidata_parser reads file and put information to the ETS table.
%%%
%%%      Each file with UNIDATA is parsed to the list of the ETS tables.
%%%      Fun can read from ETS table.
%%%      If ETS table will be deleted, then fun will be reloaded.
%%% @end
%%% @private


-module(ux_unidata).
-author('Uvarov Michael <freeakk@gmail.com>').
-export([get_source_file/1,
        get_unidata_dir/0, get_ucadata_dir/0]).
-export([char_to_upper/1, char_to_lower/1, is_upper/1, is_lower/1,
        char_comment/1, char_type/1, ccc/1, 
        nfc_qc/1, nfd_qc/1, nfkc_qc/1, nfkd_qc/1, 
        is_comp_excl/1, is_compat/1, decomp/1, comp/2,
        ducet/1, char_block/1]).
-include("ux_unidata.hrl").

-spec get_source_file(Parser::atom()) -> string().
get_source_file(allkeys) ->
    code:priv_dir(ux) ++ "/UNIDATA/allkeys.txt";
get_source_file(blocks) ->
    code:priv_dir(ux) ++ "/UNIDATA/Blocks.txt";
get_source_file(comp_exclusions) ->
    code:priv_dir(ux) ++ "/UNIDATA/CompositionExclusions.txt";
get_source_file(norm_props) ->
    code:priv_dir(ux) ++ "/UNIDATA/DerivedNormalizationProps.txt";
get_source_file(unidata) ->
    code:priv_dir(ux) ++ "/UNIDATA/UnicodeData.txt".

-spec is_upper(C::char()) -> boolean().
-spec is_lower(C::char()) -> boolean().
-spec char_type(C::char()) -> atom().
-spec char_comment(C::char()) -> binary().
-spec ccc(C::char()) -> integer().
-spec nfc_qc(C::char()) -> y | n | m.
-spec nfd_qc(C::char()) -> y | n | m.
-spec nfkc_qc(C::char()) -> y | n | m.
-spec nfkd_qc(C::char()) -> y | n | m.
-spec is_compat(C::char()) -> true | false.
-spec is_comp_excl(C::char()) -> true | false.
-spec ducet(list()) -> list() | atom().
-spec comp(integer(), integer()) -> integer() | false.
-spec decomp(integer()) -> list().

func(Parser, Type, Value) -> 
    F = ux_unidata_filelist:get_source(Parser, Type),
    F(Value).
char_to_upper(C) -> func(unidata, to_upper, C).
char_to_lower(C) -> func(unidata, to_lower, C).
is_upper(C) -> func(unidata, is_upper, C).
is_lower(C) -> func(unidata, is_lower, C).
char_type(C) -> func(unidata, type, C).
char_comment(C) -> func(unidata, comment, C).
ccc(C) -> func(unidata, ccc, C).
nfc_qc(C) -> func(norm_props, nfc_qc, C).
nfd_qc(C) -> func(norm_props, nfd_qc, C).
nfkc_qc(C) -> func(norm_props, nfkc_qc, C).
nfkd_qc(C) -> func(norm_props, nfkd_qc, C).
is_compat(C) -> func(unidata, is_compat, C).
is_comp_excl(C) -> func(comp_exclusions, is_exclusion, C).
ducet(L) -> func(allkeys, ducet, L).
comp(C1, C2) -> func(unidata, comp, {C1, C2}).
decomp(C) -> func(unidata, decomp, C).
char_block(C) -> func(blocks, block, C).


priv_dir() ->
    case code:priv_dir(ux) of
        [_|_] = Res -> Res;
        _ -> "../priv"
    end.
get_unidata_dir() -> priv_dir() ++ "/" ++ ?UNIDATA_VERSION ++ "/".
get_ucadata_dir() -> priv_dir() ++ "/" ++ ?UCADATA_VERSION ++ "/".

